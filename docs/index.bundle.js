"use strict";(self.webpackChunklearning_threejs_baz=self.webpackChunklearning_threejs_baz||[]).push([[826],{126:(t,e,i)=>{var s=i(477),o=i(79),a=i(11),n=i(452),r=i(259),h=i(365);class d{constructor(){this.initComponents(),this.bindEvents()}initComponents(){this.el=document.querySelector("[data-loading-screen]")}bindEvents(){this.el.addEventListener("transitionend",this.destroy.bind(this))}hide(){this.el.classList.add("fade-out")}destroy(){this.el.remove()}}var l=i(376);function c(t,e,i,s,o){return(t-e)*(o-s)/(i-e)+s}class g{constructor(t,e,i,o){this.gui=new l.XS,this.camera=t,this.scene=e.scene,this.materials=e.materials,this.time=0,this.skyLightColour={h:195,s:.9,v:.8},this.bounceLightColour={h:27,s:.5,v:.6},this.keyLightColour={h:50,s:.25,v:.9},this.initObjects();const a=this.gui.addFolder("Camera");a.add(this.camera.position,"x",-500,500),a.add(this.camera.position,"y",0,200),a.add(this.camera.position,"z",0,500),this.layout();const n=this.scene.getObjectByName("skyLight");if(n&&(this.fillControlsFolder=this.gui.addFolder("Fill light controls"),this.fillControlsFolder.addColor(this,"skyLightColour").listen().onChange((t=>{n.color=this.datHSVtoColor(t)})),this.fillControlsFolder.addColor(this,"bounceLightColour").listen().onChange((t=>{n.groundColor=this.datHSVtoColor(t)})),this.fillControlsFolder.add(n,"intensity",0,1,.1).listen().name("sky intensity"),this.fillControlsFolder.add(this.terrainMesh.material,"envMapIntensity",0,1,.01).name("BG envMap"),this.fillControlsFolder.add(this.midGroundMesh.material,"envMapIntensity",0,1,.01).name("MG envMap")),this.keyLightGroup=this.scene.getObjectByName("keyLightGroup"),this.keyLight=this.scene.getObjectByName("keyLight"),this.keyLightHelper=this.scene.getObjectByName("keyLight-helper"),this.keyLight){const t=this.gui.addFolder("Key light controls");var r={x:0,y:s.M8C.radToDeg(this.keyLightGroup.rotation.y),z:0};t.add(r,"y",-360,0).name("azimuth (x)").onChange((t=>{this.keyLightGroup.rotation.y=s.M8C.degToRad(t),this.updateLight(this.keyLight,this.keyLightHelper)})),t.add(this.keyLight.position,"y",0,1500).name("elevation (y)").listen().onChange((()=>{this.updateLight(this.keyLight,this.keyLightHelper)})),t.add(this.keyLight.position,"z",-3e3,3e3).name("z").listen().onChange((()=>{this.updateLight(this.keyLight,this.keyLightHelper)})),t.add(this.keyLight,"intensity",0,10,.1).listen(),t.addColor(this,"keyLightColour").listen().onChange((t=>{this.keyLight.color=this.datHSVtoColor(t),this.updateLight(this.keyLight,this.keyLightHelper)}))}this.timeSlider();const h=this.gui.addFolder("Debug");h.add(this,"outputObjects"),h.open()}initObjects(){this.terrain=this.scene.getObjectByName("terrain"),this.terrainMesh=this.terrain?.children[0],this.midGround=this.scene.getObjectByName("midGround"),this.midGroundMesh=this.midGround?.children[0],this.foreGround=this.scene.getObjectByName("ground1")}layout(){if(this.layoutFolder=this.gui.addFolder("Layout folder"),this.layoutFolder.open(),this.terrain){const e=this.terrainMesh.material;var t={x:0,y:s.M8C.radToDeg(this.terrainMesh.rotation.y),z:0};this.layoutFolder.add(t,"y",0,360).name("BG rotation y").onChange((t=>{this.terrainMesh.rotation.y=s.M8C.degToRad(t)})),this.layoutFolder.add(e,"roughness",0,1,.01).name("BG roughness")}if(this.midGround&&(this.layoutFolder.add(this.midGround.position,"y",-20,5,.1).name("MG y"),this.layoutFolder.add(this.midGroundMesh.material,"roughness",.5,1.5,.01).name("MG roughness")),this.foreGround){var e={x:0,y:s.M8C.radToDeg(this.foreGround.rotation.y),z:0};this.layoutFolder.add(e,"y",0,360).name("FG rotation y").onChange((t=>{this.foreGround.rotation.y=s.M8C.degToRad(t)}))}}timeSlider(){const t=this.gui.addFolder("Time of day");t.add(this,"time",0,1,.01).onChange((()=>{const t=Math.sin(Math.PI*this.time);this.keyLight&&(this.keyLightGroup.rotation.y=c(this.time,0,1,s.M8C.degToRad(-15),s.M8C.degToRad(-90)),this.keyLight.position.y=c(t,0,1,50,700),this.updateLight(this.keyLight,this.keyLightHelper),this.keyLight.intensity=c(t,0,1,1.5,5),this.keyLightColour.h=c(t,0,1,15,45),this.keyLightColour.s=c(t,0,1,.8,.3),this.keyLightColour.v=c(t,0,1,.5,.8),this.keyLight.color=this.datHSVtoColor(this.keyLightColour)),this.fillLight&&(this.fillLight.intensity=c(t,0,1,.4,0),this.skyLightColour.h=c(t,0,1,230,195),this.skyLightColour.s=c(t,0,1,.6,.3),this.skyLightColour.v=c(t,0,1,.5,.7),this.fillLight.color=this.datHSVtoColor(this.skyLightColour),this.bounceLightColour.s=c(t,0,1,.3,.5),this.bounceLightColour.v=c(t,0,1,.2,.6),this.fillLight.groundColor=this.datHSVtoColor(this.bounceLightColour));const e=this.scene.getObjectByName("terrain");e&&(e.children[0].material.envMapIntensity=c(t,0,1,0,.1));const i=this.scene.getObjectByName("midGround");i&&(i.children[0].material.envMapIntensity=c(t,0,1,0,.1));const o=this.scene.getObjectByName("ground1");o&&(o.children[0].material.envMapIntensity=c(t,0,1,0,.5))})),t.open()}onLoad(){const t=this.scene.getObjectByName("ground1");if(t){const e=t.children[0].material;this.layoutFolder.add(e,"roughness",0,1,.01).name("FG roughness"),this.fillControlsFolder.add(e,"envMapIntensity",0,1,.01).name("FG envMap")}}datHSVtoColor(t){const e=t.h.toFixed(),i=(100*t.s).toFixed(),o=(100*t.v).toFixed();return new s.Ilk(`hsl(${e}, ${i}%, ${o}%)`)}updateLight(t,e){t.target.updateMatrixWorld(),e.update()}outputObjects(){console.log(this.scene)}}class u{constructor(t,e,i){this.scene=t,this.textureLoader=e,this.gizmo=i,this.environmentMap(),this.skyLight(),this.keyLight()}environmentMap(){this.textureLoader.load("environments/goegap_4k.exr",(t=>{t.mapping=s.dSO,t.encoding=s.knz,this.scene.environment=t,this.scene.background=t}))}skyLight(){const t=new s.vmT;t.name="skyLight",t.color=new s.Ilk("hsl(230, 60%, 50%)"),t.groundColor=new s.Ilk("hsl(27, 30%, 20%)"),t.intensity=.3,this.scene.add(t)}keyLight(){const t=new s.ZAu;t.name="keyLightGroup";const e=new s.Ox3;e.name="keyLight",e.color=new s.Ilk("hsl(15, 80%, 50%)"),e.intensity=1.5,t.rotation.y=s.M8C.degToRad(-20),e.position.set(0,50,-1e3),e.target.position.set(0,0,0),e.castShadow=!0,e.shadow.camera.left=-800,e.shadow.camera.right=800,e.shadow.camera.bottom=-800,e.shadow.camera.top=800,e.shadow.camera.near=100,e.shadow.camera.far=2e3,e.shadow.mapSize.width=4096,e.shadow.mapSize.height=4096,t.add(e),this.scene.add(e.target);const i=new s.cBI(e);i.name="keyLight-helper",this.scene.add(i);const o=new s.Rki(e.shadow.camera);this.scene.add(o),this.scene.add(t)}update(){this.spotLightHelper&&this.spotLightHelper.update(),this.shadowHelper&&this.shadowHelper.update()}}class m{constructor(t){this.textureLoader=t,this.materials={},this.rootObject=null,this.initMaterials(),this.initGeo()}initMaterials(){this.materials.default=new s.Wid({displacementMap:this.textureLoader.load("surfaces/gigantic-terrain/vd5sdas_4K_Displacement.jpg"),displacementScale:200,normalMap:this.textureLoader.load("surfaces/gigantic-terrain/vd5sdas_4K_Normal.jpg"),roughnessMap:this.textureLoader.load("surfaces/gigantic-terrain/vd5sdas_4K_Roughness.jpg"),map:this.textureLoader.load("surfaces/sandy-ground/vl0macqn_4K_Albedo.jpg"),envMapIntensity:0}),this.materials.default.map.encoding=s.knz}initGeo(){this.rootObject=new s.ZAu,this.rootObject.name="terrain";const t=new s._12(1e4,1e4,2e3,2e3);t.rotateX(-Math.PI/2);const e=new s.Kj0(t,this.materials.default);e.castShadow=!0,e.receiveShadow=!0,e.rotation.y=s.M8C.degToRad(204),this.rootObject.add(e),this.rootObject.position.y=-110,this.rootObject.position.x=1660,this.rootObject.position.z=340}update(){}}class p{constructor(t){this.textureLoader=t,this.materials={},this.rootObject=null,this.initMaterials(),this.initGeo()}initMaterials(){this.materials.default=new s.Wid({displacementMap:this.loadTiledTexture("surfaces/sandy-ground/vl0macqn_4K_Displacement.jpg",10),displacementScale:20,normalMap:this.loadTiledTexture("surfaces/sandy-ground/vl0macqn_4K_Normal.jpg",10),roughnessMap:this.loadTiledTexture("surfaces/sandy-ground/vl0macqn_4K_Roughness.jpg",10),roughness:1.05,map:this.loadTiledTexture("surfaces/sandy-ground/vl0macqn_4K_Albedo.jpg",10),envMapIntensity:0}),this.materials.default.map.encoding=s.knz}loadTiledTexture(t,e){return this.textureLoader.load(t,(function(t){t.wrapS=t.wrapT=s.rpg,t.offset.set(0,0),t.repeat.set(e,e)}))}initGeo(){this.rootObject=new s.ZAu,this.rootObject.name="midGround";const t=new s._12(3e3,3e3,2e3,2e3);t.rotateX(-Math.PI/2);const e=new s.Kj0(t,this.materials.default);e.castShadow=!0,e.receiveShadow=!0,this.rootObject.add(e),this.rootObject.position.y=-8.5}update(){}}class y{constructor(t,e){this.geoLoader=t,this.textureLoader=e,this.materials={},this.rootObject=null,this.initMaterials(),this.initGeo()}initMaterials(){this.materials.default=new s.Wid({normalMap:this.textureLoader.load("models/ground1/textures/vmoebgzqx_4K_Normal_LOD0.jpg"),roughnessMap:this.textureLoader.load("models/ground1/textures/vmoebgzqx_4K_Roughness.jpg"),roughness:.85,map:this.textureLoader.load("models/ground1/textures/vmoebgzqx_4K_Albedo.jpg"),envMapIntensity:0}),this.materials.default.map.encoding=s.knz}initGeo(){this.rootObject=new s.ZAu,this.rootObject.name="ground1",this.geoLoader.load("models/ground1/vmoebgzqx_LOD0.fbx",(t=>{const e=t.children[0];e.geometry.attributes.uv2=e.geometry.attributes.uv,e.castShadow=!0,e.receiveShadow=!0,e.material=this.materials.default,this.rootObject.add(e)})),this.rootObject.rotation.y=s.M8C.degToRad(303)}update(){}}const L=function(t){var e=new o.Z;return e.showPanel(0),document.body.appendChild(e.dom),e}(),w=function(t){const e=new s.CP7({powerPreference:"high-performance",alpha:!0});return e.setSize(window.innerWidth,window.innerHeight),e.shadowMap.enabled=!0,e.shadowMapSoft=!0,e.shadowMap.type=s.ntZ,e.physicallyCorrectLights=!0,e.outputEncoding=s.knz,document.getElementById("webgl-output").appendChild(e.domElement),e}(),b=function(t){var e=void 0!==t?t:new s.Pa4(0,22,50),i=new s.cPb(45,window.innerWidth/window.innerHeight,1,1e4);return i.position.copy(e),i.lookAt(new s.Pa4(0,0,0)),i}(new s.Pa4(-154,50,118)),C=new class{constructor(t,e){this.renderer=t,this.camera=e,this.scene=new s.xsS,this.loadingManager=new s.lLk,this.materials={},this.pickableMeshes=[],this.objLoader=new a.L(this.loadingManager),this.objLoader.setPath("assets/"),this.fbxLoader=new n.y(this.loadingManager),this.fbxLoader.setPath("assets/"),this.textureLoader=new s.dpR(this.loadingManager),this.textureLoader.setPath("assets/"),this.exrLoader=new r.I(this.loadingManager),this.exrLoader.setPath("assets/"),this.orbitControls=this.initControls(),this.addObjects(),this.lights=new u(this.scene,this.exrLoader),this.initComponents(),this.bindEvents()}initControls(){const t=new h.z(this.camera,this.renderer.domElement);return t.target=new s.Pa4(0,20,0),t.enablePan=!1,t.minPolarAngle=s.M8C.degToRad(50),t.maxPolarAngle=s.M8C.degToRad(85),t.minDistance=30,t.maxDistance=180,t.autoRotate=!1,t.enableDamping=!0,t}addObjects(){const t=new s.VLJ(500,10);t.material.transparent=!0,t.material.opacity=.25;const e=new s.y8_(10);this.scene.add(e),this.terrain=new m(this.textureLoader),this.scene.add(this.terrain.rootObject),this.midGround=new p(this.textureLoader),this.scene.add(this.midGround.rootObject),this.ground1=new y(this.fbxLoader,this.textureLoader),this.scene.add(this.ground1.rootObject)}initComponents(){this.loadingScreen=new d,this.settingsPanel=new g(this.camera,this)}bindEvents(){this.loadingManager.onLoad=this.onLoad.bind(this)}onLoad(){this.settingsPanel.onLoad(),this.loadingScreen.hide()}update(){this.orbitControls.update()}fitCameraToSelection(t,e,i,o=1.1){const a=new s.ZzF;for(const t of i)a.expandByObject(t);const n=a.getSize(new s.Pa4),r=a.getCenter(new s.Pa4),h=Math.max(n.x,n.y,n.z)/(2*Math.atan(Math.PI*t.fov/360)),d=h/t.aspect,l=o*Math.max(h,d),c=e.target.clone().sub(t.position).normalize().multiplyScalar(l);e.minDistance=l/2,e.maxDistance=3*l,e.target.copy(r),e.target.y=-4,t.near=l/100,t.far=100*l,t.updateProjectionMatrix(),t.position.copy(e.target).sub(c),e.update()}}(w,b);window.addEventListener("resize",(function(){b.aspect=window.innerWidth/window.innerHeight,b.updateProjectionMatrix(),w.setSize(window.innerWidth,window.innerHeight)}),!1),function t(){L.update(),C.update(),w.render(C.scene,b),window.requestAnimationFrame(t)}()}},t=>{t.O(0,[813,474],(()=>(126,t(t.s=126)))),t.O()}]);